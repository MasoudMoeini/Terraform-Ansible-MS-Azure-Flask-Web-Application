---
  - name: "Running Flask App with Ansible"
    hosts: localhost
    connection: local 
    tasks:
    #- name: installing python virtual environment
     # command: python3 -m venv venv
    #- name:  Activating virtual env
     # command:  . venv/bin/activate
      #command: python3 -m venv venv
    - name: install the package, force upgrade
      pip:
        name: pip
        executable: pip3
        state: latest
    - name: Your copy task
      copy: src={{ item.src }} dest={{ item.dest }}
      with_items:
        - { src: 'requirements.txt', dest: '/home/requirements.txt' }
        - { src: 'app.py', dest: '$HOME/app.py' }
        - { src: 'main.py', dest: '$HOME/main.py' }
        - { src: 'minst.py', dest: '$HOME/minst.py' }
        - { src: 'model.h5', dest: '$HOME/model.h5' }
        - { src: 'templates/', dest: '$HOME/templates/' }
    - name: install python libraries
      pip:
        requirements: root/requirements.txt
        extra_args: --no-cache-dir
    - name: copy template systemd service config
      copy:
        src: .service
        dest: /etc/systemd/system/flask.service
    - name: Start Systemd Flask App Service 
      systemd: name=flask state=started daemon_reload=yes